
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/igmhub/LaCE/users/compressedParameters/">
      
      
        <link rel="prev" href="../emulatorPredictions/">
      
      
        <link rel="next" href="../../developers/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Compressed Parameters - LaCE Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#estimating-compressed-parameters-with-cosmopower" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LaCE Documentation" class="md-header__button md-logo" aria-label="LaCE Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LaCE Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Compressed Parameters
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LaCE Documentation" class="md-nav__button md-logo" aria-label="LaCE Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    LaCE Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Simulations_list/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Available Simulations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Emulators_trainingSets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emulators and Training Sets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../emulatorTraining/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emulator Training
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../emulatorPredictions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emulator Predictions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Compressed Parameters
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Compressed Parameters
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#making-predictions-with-cosmopower" class="md-nav__link">
    <span class="md-ellipsis">
      Making predictions with cosmopower
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Making predictions with cosmopower">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Making predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estimating-compressed-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Estimating compressed parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estimating compressed parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-indivudual-cosmologies" class="md-nav__link">
    <span class="md-ellipsis">
      For indivudual cosmologies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-a-cosmology-chain" class="md-nav__link">
    <span class="md-ellipsis">
      For a cosmology chain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-your-own-cosmopower-emulator" class="md-nav__link">
    <span class="md-ellipsis">
      Training your own cosmopower emulator
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/CreateNewEmulator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating New Emulators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/UnderDevelopment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Under development solutions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/advancedTesting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#making-predictions-with-cosmopower" class="md-nav__link">
    <span class="md-ellipsis">
      Making predictions with cosmopower
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Making predictions with cosmopower">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Making predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estimating-compressed-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Estimating compressed parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Estimating compressed parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-indivudual-cosmologies" class="md-nav__link">
    <span class="md-ellipsis">
      For indivudual cosmologies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-a-cosmology-chain" class="md-nav__link">
    <span class="md-ellipsis">
      For a cosmology chain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-your-own-cosmopower-emulator" class="md-nav__link">
    <span class="md-ellipsis">
      Training your own cosmopower emulator
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="estimating-compressed-parameters-with-cosmopower">ESTIMATING COMPRESSED PARAMETERS WITH COSMOPOWER</h1>
<p>To estimate the compressed parameters with cosmopower, one needs to follow the <a href="../../installation/">installation instructions</a> of LaCE with cosmopower.</p>
<ol>
<li><a href="#making-predictions-with-cosmopower">Making predictions with cosmopower</a></li>
<li><a href="#estimating-compressed-parameters">Estimating compressed parameters</a><ol>
<li><a href="#for-indivudual-cosmologies">For individual cosmologies</a> </li>
<li><a href="#for-a-cosmology-chain">For a cosmology chain</a></li>
</ol>
</li>
<li><a href="#training-your-own-cosmopower-emulator">Training your own cosmopower emulator</a></li>
</ol>
<h2 id="making-predictions-with-cosmopower">Making predictions with cosmopower</h2>
<p>To see examples of how to make predictions with cosmopower, one can follow the tutorial notebook in the notebooks folder (Tutorial_compressed_parameters.ipynb).</p>
<p>Cosmopower emulates the linear matter power spectrum. To use the emulator, one needs to provide a set of cosmological parameters that depend on the cosmological parameters used to train the emulator. LaCE contains several trained cosmopower emulators, and you can also train your own emulator as described in <a href="#training-your-own-cosmopower-emulator">Training your own cosmopower emulator</a>.</p>
<p>To load an emulator, you need to do: </p>
<div class="codehilite"><pre><span></span><code><span class="n">cp_nn</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">cosmopower_NN</span><span class="p">(</span><span class="n">restore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                         <span class="n">restore_filename</span><span class="o">=</span><span class="n">emu_path</span><span class="p">)</span>
</code></pre></div>

<p>There are three trained cosmopower emulators that you can find in the data folder:
- <code>Pk_cp_NN.pkl</code>: $\Lambda$CDM emulator.
- <code>Pk_cp_NN_sumnu.pkl</code>: $\Lambda$ CDM + $\sum m_\nu$ emulator.
- <code>Pk_cp_NN_nrun.pkl</code>: $\Lambda$ CDM + $\sum m_\nu$ + $n_{\rm run}$ emulator.</p>
<p>When providing the path to the emulator, you need to give the path to the <code>Pk_cp_NN.pkl</code> or <code>Pk_cp_NN_sumnu.pkl</code> file <strong>without</strong> the <code>.pkl</code> extension.</p>
<p>To know the parameters that the emulator uses, you can do:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">cp_nn</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</code></pre></div>

<p>And to access the k values, you can do:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">cp_nn</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
</code></pre></div>

<h3 id="making-predictions">Making predictions</h3>
<p>To make predictions with cosmopower, you need to provide a dictionary with the parameters that the emulator uses.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Define the cosmology dictionary</span>
<span class="n">cosmo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;H0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;H0&quot;</span><span class="p">]],</span>
         <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;H0&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">],</span>
         <span class="s1">&#39;mnu&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;mnu&quot;</span><span class="p">]],</span>
         <span class="s1">&#39;Omega_m&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;omch2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;ombh2&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;H0&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
         <span class="s1">&#39;Omega_Lambda&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span> <span class="p">(</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;omch2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;ombh2&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;H0&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
         <span class="s1">&#39;omch2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;omch2&quot;</span><span class="p">]],</span>
         <span class="s1">&#39;ombh2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;ombh2&quot;</span><span class="p">]],</span>
         <span class="s1">&#39;As&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;As&quot;</span><span class="p">]],</span>
         <span class="s1">&#39;ns&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;ns&quot;</span><span class="p">]],</span>
         <span class="s1">&#39;nrun&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cosmo_params</span><span class="p">[</span><span class="s2">&quot;nrun&quot;</span><span class="p">]]}</span>
</code></pre></div>

<p>Some of these parameters are not used by the emulator, but they are needed to convert to km/s. When calling the emulator, it will inform you if some of the parameters are not used.</p>
<p>To call the emulator:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Pk_Mpc</span> <span class="o">=</span> <span class="n">cp_nn</span><span class="o">.</span><span class="n">ten_to_predictions_np</span><span class="p">(</span><span class="n">cosmo</span><span class="p">)</span>
</code></pre></div>

<p>Then to convert to km/s, you can do:</p>
<div class="codehilite"><pre><span></span><code><span class="n">k_kms</span><span class="p">,</span> <span class="n">Pk_kms</span> <span class="o">=</span> <span class="n">linPCosmologyCosmopower</span><span class="o">.</span><span class="n">convert_to_kms</span><span class="p">(</span><span class="n">cosmo</span><span class="p">,</span> 
                                                       <span class="n">k_Mpc</span><span class="p">,</span> 
                                                       <span class="n">Pk_Mpc</span><span class="p">,</span> 
                                                       <span class="n">z_star</span> <span class="o">=</span> <span class="n">z_star</span><span class="p">)</span>
</code></pre></div>

<h2 id="estimating-compressed-parameters">Estimating compressed parameters</h2>
<h3 id="for-indivudual-cosmologies">For indivudual cosmologies</h3>
<p>Once you have the predictions, you can estimate the compressed parameters fitting a polynomial to the power spectrum:</p>
<div class="codehilite"><pre><span></span><code><span class="n">linP_kms</span> <span class="o">=</span> <span class="n">linPCosmologyCosmopower</span><span class="o">.</span><span class="n">fit_polynomial</span><span class="p">(</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">kmin_kms</span> <span class="o">/</span> <span class="n">kp_kms</span><span class="p">,</span> 
    <span class="n">xmax</span><span class="o">=</span> <span class="n">kmax_kms</span> <span class="o">/</span> <span class="n">kp_kms</span><span class="p">,</span> 
    <span class="n">x</span> <span class="o">=</span> <span class="n">k_kms</span> <span class="o">/</span> <span class="n">kp_kms</span><span class="p">,</span> 
    <span class="n">y</span> <span class="o">=</span> <span class="n">Pk_kms</span><span class="p">,</span> 
    <span class="n">deg</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</code></pre></div>

<p>and then estimate the star parameters:</p>
<div class="codehilite"><pre><span></span><code><span class="n">starparams_CP</span> <span class="o">=</span> <span class="n">linPCosmologyCosmopower</span><span class="o">.</span><span class="n">get_star_params</span><span class="p">(</span><span class="n">linP_kms</span> <span class="o">=</span> <span class="n">linP_kms</span><span class="p">,</span> 
                                                          <span class="n">kp_kms</span> <span class="o">=</span> <span class="n">kp_kms</span><span class="p">)</span>
</code></pre></div>

<p>where <code>linP_kms</code> are the linear matter power spectrum predictions in km/s and <code>kp_kms</code> is the pivot point in s/km. </p>
<h3 id="for-a-cosmology-chain">For a cosmology chain</h3>
<p>To estimate the parameters for a cosmology chain, you first need to call the class:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fitter_compressed_params</span> <span class="o">=</span> <span class="n">linPCosmologyCosmopower</span><span class="p">(</span><span class="n">cosmopower_model</span> <span class="o">=</span> <span class="n">cosmopower_model</span><span class="p">)</span>
</code></pre></div>

<p>Then check the expected parameters of the cosmopower model:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">fitter_compressed_params</span><span class="o">.</span><span class="n">cp_emulator</span><span class="o">.</span><span class="n">cp_emulator</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</code></pre></div>

<p>And create a dictionary with the naming convertion between the parameters in your chain and the parameters used by the cosmopower model. We need additional parameters to convert to km/s. The dictionary keys are the parameters used by the cosmopower model and the values are the parameters in your chain.</p>
<div class="codehilite"><pre><span></span><code><span class="n">param_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span>
    <span class="s1">&#39;m_ncdm&#39;</span><span class="p">:</span> <span class="s1">&#39;m_ncdm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;omch2&#39;</span><span class="p">:</span> <span class="s1">&#39;omega_cdm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Omega_m&#39;</span><span class="p">:</span> <span class="s1">&#39;Omega_m&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Omega_Lambda&#39;</span><span class="p">:</span> <span class="s1">&#39;Omega_Lambda&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ln_A_s_1e10&#39;</span><span class="p">:</span> <span class="s1">&#39;ln_A_s_1e10&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ns&#39;</span><span class="p">:</span> <span class="s1">&#39;n_s&#39;</span><span class="p">,</span>
    <span class="s1">&#39;nrun&#39;</span><span class="p">:</span> <span class="s1">&#39;nrun&#39;</span>
<span class="p">}</span>
</code></pre></div>

<p>To estimate the parameters, you can do:</p>
<div class="codehilite"><pre><span></span><code><span class="n">linP_cosmology_results</span> <span class="o">=</span> <span class="n">fitter_compressed_params</span><span class="o">.</span><span class="n">fit_linP_cosmology</span><span class="p">(</span><span class="n">chains_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> 
                                                                     <span class="n">param_mapping</span> <span class="o">=</span> <span class="n">param_mapping</span><span class="p">)</span>
</code></pre></div>

<p>By default in loads the $\Lambda$CDM + $\sum m_\nu$ + $n_{\rm run}$ emulator. If you want to use another emulator, specify the name in the class argument <code>cosmopower_model</code> and save the model in the <code>data/cosmopower_models</code> folder. The model needs to be a <code>.pkl</code> file and the it must be called without the <code>.pkl</code> extension.</p>
<h2 id="training-your-own-cosmopower-emulator">Training your own cosmopower emulator</h2>
<p>To train your own cosmopower emulator, you can follow the tutorial notebook.</p>
<p>First, one needs to create a LH sampler with the parameters of interest. For example, to create a LH sampler with the $\Lambda$CDM + $\sum m_\nu$ emulator, you can do:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#Define the parameters used by the emulator and the ranges</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ombh2&quot;</span><span class="p">,</span> <span class="s2">&quot;omch2&quot;</span><span class="p">,</span> <span class="s2">&quot;H0&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">,</span> <span class="s2">&quot;As&quot;</span><span class="p">,</span> <span class="s2">&quot;mnu&quot;</span><span class="p">,</span> <span class="s2">&quot;nrun&quot;</span><span class="p">]</span>
<span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">],</span> 
    <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">5e-10</span><span class="p">,</span> <span class="mf">4e-9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">dict_params_ranges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">ranges</span><span class="p">))</span>
</code></pre></div>

<p>And create the LH sample as:</p>
<div class="codehilite"><pre><span></span><code><span class="n">create_LH_sample</span><span class="p">(</span><span class="n">dict_params_ranges</span> <span class="o">=</span> <span class="n">dict_params_ranges</span><span class="p">,</span>
                     <span class="n">nsamples</span> <span class="o">=</span> <span class="mi">10_000</span><span class="p">,</span>
                     <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;LHS_params_sumnu.npz&quot;</span><span class="p">)</span>
</code></pre></div>

<p>After that, you need to create the power spectrum to train the emulator. </p>
<div class="codehilite"><pre><span></span><code><span class="n">generate_training_spectra</span><span class="p">(</span><span class="n">input_LH_filename</span> <span class="o">=</span> <span class="s1">&#39;LHS_params_sumnu.npz&#39;</span><span class="p">,</span>
                          <span class="n">output_filename</span> <span class="o">=</span> <span class="s2">&quot;linear_sumnu.dat&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Make sure that the input file is the one you created in the previous step. This calls CAMB to generate the power spectrum. It takes time to run. So far, we have not needed a long training sample to reach good accuracy.</p>
<p>Once the power spectrum is generated, you can train the emulator with:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cosmopower_prepare_training</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span>
                            <span class="n">Pk_filename</span> <span class="o">=</span> <span class="s2">&quot;linear_test.dat&quot;</span><span class="p">)</span>
</code></pre></div>

<p>followed by:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cosmopower_train_model</span><span class="p">(</span>
                        <span class="n">model_save_filename</span> <span class="o">=</span> <span class="s2">&quot;Pk_cp_NN_test&quot;</span><span class="p">,</span>
                        <span class="n">model_params</span> <span class="o">=</span> <span class="n">params</span>
<span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>